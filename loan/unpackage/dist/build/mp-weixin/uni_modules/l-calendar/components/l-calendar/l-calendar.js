"use strict";const t=require("../../../../common/vendor.js"),e=require("./calendar.js"),a={name:"lCalendar",props:{visible:{type:Boolean,default:!1},isRange:{type:Boolean,default:!1},maxYear:{type:Number,default:2100},minYear:{type:Number,default:1920},minDate:{type:String,default:"1920-01-01"},maxDate:{type:String,default:(new Date).getFullYear()+100+"-12-31"},title:{type:String,default:"日期选择"},monthChangeColor:{type:String,default:"#999"},yearChangeColor:{type:String,default:"#bfbfbf"},color:{type:String,default:"#333"},activeColor:{type:String,default:"#fff"},activeBgColor:{type:String,default:"#55BBF9"},rangeBgColor:{type:String,default:"rgba(85, 187, 249, 0.1)"},rangeColor:{type:String,default:"#55BBF9"},startText:{type:String,default:"开始"},endText:{type:String,default:"结束"},lunar:{type:Boolean,default:!0},initStartDate:{type:String,default:""},initEndDate:{type:String,default:""},idCard:{type:Boolean,default:!1}},data:()=>({weekday:1,weekdayArr:[],days:0,daysArr:[],showTitle:"",year:2020,month:0,day:0,startYear:0,startMonth:0,startDay:0,endYear:0,endMonth:0,endDay:0,today:"",activeDate:"",startDate:"",endDate:"",isStart:!0,min:null,max:null,dateHeight:20}),computed:{dataChange(){return`${this.type}-${this.minDate}-${this.maxDate}-${this.initStartDate}-${this.initEndDate}`},disabled(){return this.isRange&&(!this.startDate||!this.endDate)}},watch:{dataChange(t){this.init()}},created(){this.init()},methods:{getColor(t,e){let a=1==e?"":this.color,i=t+1,s=`${this.year}-${this.month}-${i}`,h=new Date(s.replace(/\-/g,"/")).getTime(),n=this.startDate.replace(/\-/g,"/"),r=this.endDate.replace(/\-/g,"/");return this.activeDate==s||this.startDate==s||this.endDate==s?a=1==e?this.activeBgColor:this.activeColor:this.endDate&&h>new Date(n).getTime()&&h<new Date(r).getTime()&&(a=1==e?this.rangeBgColor:this.rangeColor),a},getText(t,e,a){let i=this.lunar?this.getLunar(this.year,this.month,t+1):"";if(this.isRange&&this.lunar){let s=`${this.year}-${this.month}-${t+1}`;e==s&&e!=a?i=this.startText:a==s&&(i=this.endText)}return i},getLunar(t,a,i){let s=e.calendar.solar2lunar(t,a,i);return"初一"==s.IDayCn?s.IMonthCn:s.IDayCn},init(){this.dateHeight=t.index.getSystemInfoSync().windowWidth/7;let e=new Date;if(this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.today=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,this.activeDate=this.today,this.min=this.initDate(this.minDate),this.max=this.initDate(this.maxDate),this.isDisable(this.year,this.month,this.day)&&(this.year=this.min.year,this.month=this.min.month,this.day=this.min.day,this.activeDate=`${this.min.year}-${this.min.month}-${this.min.day}`,this.max=this.initDate(this.maxDate||this.minDate)),this.startDate="",this.startYear=0,this.startMonth=0,this.startDay=0,this.initStartDate){let t=new Date(this.initStartDate.replace(/\-/g,"/"));this.isRange?(this.startDate=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,this.startYear=t.getFullYear(),this.startMonth=t.getMonth()+1,this.startDay=t.getDate(),this.activeDate=""):(this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.activeDate=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`)}if(this.endYear=0,this.endMonth=0,this.endDay=0,this.endDate="",this.initEndDate&&this.isRange){let t=new Date(this.initEndDate.replace(/\-/g,"/"));this.endDate=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,this.endYear=t.getFullYear(),this.endMonth=t.getMonth()+1,this.endDay=t.getDate(),this.activeDate="",this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate()}this.isStart=!0,this.changeData()},initDate(t){let e=t.split("-");return{year:Number(e[0]||1920),month:Number(e[1]||1),day:Number(e[2]||1)}},isDisable(t,e,a){let i=!0,s=`${t}/${e}/${a}`,h=`${this.min.year}/${this.min.month}/${this.min.day}`,n=`${this.max.year}/${this.max.month}/${this.max.day}`,r=new Date(s).getTime();return r>=new Date(h).getTime()&&r<=new Date(n).getTime()&&(i=!1),i},generateArray:(t,e)=>Array.from(new Array(e+1).keys()).slice(t),formatNum:t=>t<10?"0"+t:t+"",getMonthDay:(t,e)=>new Date(t,e,0).getDate(),getWeekday:(t,e)=>new Date(`${t}/${e}/01 00:00:00`).getDay(),changeMonth(t){if(t){let t=this.month+1,e=t>12?this.year+1:this.year;(e>this.minYear||e<this.maxYear)&&(this.month=t>12?1:t,this.year=e,this.changeData())}else{let t=this.month-1,e=t<1?this.year-1:this.year;(e>this.minYear||e<this.maxYear)&&(this.month=t<1?12:t,this.year=e,this.changeData())}},changeYear(t){let e=t?this.year+1:this.year-1;(e>this.minYear||e<this.maxYear)&&(this.year=e,this.changeData())},changeData(){this.days=this.getMonthDay(this.year,this.month),this.daysArr=this.generateArray(1,this.days),this.weekday=this.getWeekday(this.year,this.month),this.weekdayArr=this.generateArray(1,this.weekday),this.showTitle=`${this.year}年${this.month}月`},dateClick:function(t){if(-1!==t||!this.isStart)if(-1!==t||this.isStart){if(t+=1,!this.isDisable(this.year,this.month,t)){this.day=t;let e=`${this.year}-${this.month}-${t}`;if(this.isRange){let t=new Date(e.replace(/\-/g,"/")).getTime()<new Date(this.startDate.replace(/\-/g,"/")).getTime();this.isStart||t?(this.startDate=e,this.startYear=this.year,this.startMonth=this.month,this.startDay=this.day,this.endYear=0,this.endMonth=0,this.endDay=0,this.endDate="",this.activeDate="",this.isStart=!1):(this.endDate=e,this.endYear=this.year,this.endMonth=this.month,this.endDay=this.day,this.isStart=!0)}else this.activeDate=e}}else{let e=`${this.year}-${this.month}-${t}`;this.isStart?(this.startDate=e,this.startYear=this.year,this.startMonth=this.month,this.startDay=this.day,this.endYear=0,this.endMonth=0,this.endDay=0,this.endDate="",this.activeDate="",this.isStart=!1):(this.endDate="长期",this.endYear=0,this.endMonth=0,this.endDay=0,this.isStart=!0)}},hide(){this.$emit("cancel")},getWeekText:t=>"星期"+["日","一","二","三","四","五","六"][(t=new Date(`${t.replace(/[-.]/g,"/")} 00:00:00`)).getDay()],confireBtnClick(t){if(!this.disabled)if(t||this.hide(),this.isRange){if(!this.startDate||!this.endDate)return;let t=this.formatNum(this.startMonth),a=this.formatNum(this.startDay),i=`${this.startYear}/${t}/${a}`,s=this.getWeekText(i),h=e.calendar.solar2lunar(this.startYear,t,a),n=this.formatNum(this.endMonth),r=this.formatNum(this.endDay),o="";o="长期"!==this.endDate?`${this.endYear}/${n}/${r}`:this.endDate;let d=this.getWeekText(o),l=e.calendar.solar2lunar(this.endYear,n,r);this.$emit("confirm",{startYear:this.startYear,startMonth:this.startMonth,startDay:this.startDay,startDate:i,startWeek:s,startLunar:h,endYear:this.endYear,endMonth:this.endMonth,endDay:this.endDay,endDate:o,endWeek:d,endLunar:l})}else{let t=this.activeDate.split("-"),a=+t[0],i=+t[1],s=+t[2],h=this.getMonthDay(a,i),n=`${a}-${this.formatNum(i)}-${this.formatNum(s)}`,r=this.getWeekText(n),o=!1;`${a}-${i}-${s}`==this.today&&(o=!0);let d=e.calendar.solar2lunar(a,i,s);this.$emit("confirm",{year:a,month:i,day:s,days:h,result:n,week:r,isToday:o,lunar:d})}}}};const i=t._export_sfc(a,[["render",function(e,a,i,s,h,n){return t.e({a:t.t(i.title),b:t.o(((...t)=>n.hide&&n.hide(...t))),c:i.yearChangeColor,d:t.o((t=>n.changeYear(!1))),e:i.monthChangeColor,f:t.o((t=>n.changeMonth(!1))),g:t.t(h.showTitle),h:i.monthChangeColor,i:t.o((t=>n.changeMonth(!0))),j:i.yearChangeColor,k:t.o((t=>n.changeYear(!0))),l:i.idCard},i.idCard?{m:t.o((t=>n.dateClick(-1)))}:{},{n:t.f(h.weekdayArr,((t,e,a)=>({a:e}))),o:t.f(h.daysArr,((e,a,s)=>t.e({a:t.t(a+1),b:t.t(n.getText(a,h.startDate,h.endDate)),c:n.getColor(a,2),d:!i.lunar&&i.isRange&&h.startDate==`${h.year}-${h.month}-${a+1}`&&h.startDate!=h.endDate},!i.lunar&&i.isRange&&h.startDate==`${h.year}-${h.month}-${a+1}`&&h.startDate!=h.endDate?{e:t.t(i.startText),f:i.activeColor}:{},{g:!i.lunar&&i.isRange&&h.endDate==`${h.year}-${h.month}-${a+1}`},!i.lunar&&i.isRange&&h.endDate==`${h.year}-${h.month}-${a+1}`?{h:t.t(i.endText),i:i.activeColor}:{},{j:n.isDisable(h.year,h.month,a+1)?1:"",k:i.isRange&&h.startDate==`${h.year}-${h.month}-${a+1}`||!i.isRange?1:"",l:i.isRange&&h.endDate==`${h.year}-${h.month}-${a+1}`||!i.isRange?1:"",m:n.getColor(a,1),n:a,o:t.o((t=>n.dateClick(a)),a)}))),p:h.dateHeight+"px",q:t.t(h.month),r:6*h.dateHeight+"px",s:t.t(i.isRange?h.startDate:h.activeDate),t:h.endDate},h.endDate?{v:t.t(h.endDate)}:{},{w:n.disabled?".5":"1",x:n.disabled,y:t.o((t=>n.confireBtnClick(!1))),z:i.visible?1:"",A:t.n(i.visible?"mask-show":""),B:t.o(((...t)=>n.hide&&n.hide(...t))),C:t.o((()=>{}))})}],["__scopeId","data-v-ec3dfbf1"]]);wx.createComponent(i);
