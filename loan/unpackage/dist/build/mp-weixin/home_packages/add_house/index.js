"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),r=require("../../utils/jump.js");if(!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-picker"))()}Math||(t+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+s+(()=>"../../node-modules/uview-plus/components/u-picker/u-picker.js"))();const t=()=>"../../components/navbar.js",s=()=>"../../components/option-bt.js",a=e.defineComponent({__name:"index",props:{type:{type:Number},houseIndex:{type:Number}},setup(t){const s=t,{appContext:a}=e.getCurrentInstance(),n=a.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const i=e.ref(null),u=e.reactive({front:"",behind:"",timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[1],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",houseImg:"",pub_value:[],pub_picker:!1,column:{},pub_name:"",select_value:0,address_show:!1,columns:[],firstIndex:0,dxMoney:""}),p=e.reactive({city_address:"",address:"",house_mortgage_order:"",area:"",house_has_type:"",house_use_type:"",house_power_type:"",price:"",card_number:"",card_name:"",owners:[],weituo_person:[]});e.onMounted((()=>{2===s.type?Object.assign(p,e.index.getStorageSync("houseArray")[s.houseIndex]):e.index.removeStorageSync("ownerArray")}));const c=()=>{l(p.price)},l=e=>{if(!/^(0|[1-9]\d*)(\.\d+)?$/.test(e))return u.dxMoney="数据非法",!1;var o="千佰拾亿千佰拾万千佰拾元角分",r="",t=(e+="00").indexOf(".");t>=0&&(e=e.substring(0,t)+e.substr(t+1,2)),o=o.substr(o.length-e.length);for(var s=0;s<e.length;s++)r+="零壹贰叁肆伍陆柒捌玖".charAt(e.charAt(s))+o.charAt(s);return u.dxMoney=r.replace(/零(千|佰|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万|壹(拾)/g,"$1$2").replace(/^元零?|零分/g,"").replace(/元$/g,"元整"),!1},d=()=>{e.index.setStorageSync("ownerArray",p.owners),e.index.setStorageSync("fczdz",(p.city_address+p.address).replace(/-/g,"")),e.index.navigateTo({url:"/home_packages/ownership/index"})},m=()=>{e.index.setStorageSync("weituo_personArray",p.weituo_person),e.index.navigateTo({url:"/home_packages/weituo_person/index"})};e.onShow((()=>{e.index.getStorageSync("ownerArray")&&(p.owners=e.index.getStorageSync("ownerArray")),e.index.getStorageSync("weituo_personArray")&&(p.weituo_person=e.index.getStorageSync("weituo_personArray"))}));const _=e=>{u.tipsText=e,u.tips_popup=!0,null!==u.tips_timer&&clearTimeout(u.tips_timer),u.tips_timer=setTimeout((()=>{u.tips_popup=!1}),2e3)};n.$request("/loan/Dictionary/getDictionary").then((e=>{let o={};e.data.records.map((e=>{o[e.key]={picker_title:e.name,list:e.values.map((e=>({name:e})))}})),u.column=o}));const h=e=>{u.select_value=e.detail.value[0]},g=e=>{u.pub_name=e,u.pub_picker=!0};n.$request("/factory_system/Base/getAreas").then((o=>{u.columns=[o.data.areas],e.nextTick$1((()=>{i.value.setColumnValues(1,u.columns[0][0].children),i.value.setColumnValues(2,u.columns[0][0].children[0].children)}))}));const y=()=>{u.address_show=!1},w=e=>{p.city_address="",e.value.map(((o,r)=>{p.city_address+=r===e.value.length-1?o.label:o.label+"-"})),y()},v=e=>{const{columnIndex:o,index:r}=e;0===o&&(u.columns[0][r].children.length?(i.value.setColumnValues(1,u.columns[0][r].children),i.value.setColumnValues(2,u.columns[0][r].children[0].children)):(i.value.setColumnValues(1,[]),i.value.setColumnValues(2,[])),u.firstIndex=r),1===o&&i.value.setColumnValues(2,u.columns[0][u.firstIndex].children[r].children)};return(t,a)=>e.e({a:e.p({title:1===s.type?"新增房产信息":"编辑房产信息"}),b:e.t(p.city_address),c:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),d:e.o((e=>{u.address_show=!0})),e:p.address,f:e.o((e=>p.address=e.detail.value)),g:e.t(p.house_mortgage_order),h:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),i:e.o((e=>g("house_mortgage_order"))),j:p.area,k:e.o((e=>p.area=e.detail.value)),l:e.t(p.house_has_type),m:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),n:e.o((e=>g("house_has_type"))),o:e.t(p.house_use_type),p:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),q:e.o((e=>g("house_use_type"))),r:e.t(p.house_power_type),s:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),t:e.o((e=>g("house_power_type"))),v:e.o(c),w:p.price,x:e.o((e=>p.price=e.detail.value)),y:e.t(u.dxMoney),z:p.card_number,A:e.o((e=>p.card_number=e.detail.value)),B:p.card_name,C:e.o((e=>p.card_name=e.detail.value)),D:e.f(p.owners,((r,t,s)=>e.e({a:e.t(r.name),b:e.o((e=>{return o=t,void p.owners.splice(o,1);var o}),t),c:"8a468c72-6-"+s,d:0===t},0===t?{e:o._imports_0$4,f:e.o((e=>d()),t)}:{},{g:t,h:e.s(t<p.owners.length-1?"margin-bottom: 10px;":"")}))),E:e.p({name:"trash",size:"5vw",color:"#FF8177"}),F:0===p.owners.length},0===p.owners.length?{G:o._imports_0$4,H:e.o((e=>d()))}:{},{I:e.f(p.weituo_person,((r,t,s)=>e.e({a:e.t(r.name),b:e.o((e=>{return o=t,void p.weituo_person.splice(o,1);var o}),t),c:"8a468c72-7-"+s,d:0===t},0===t?{e:o._imports_0$4,f:e.o((e=>m()),t)}:{},{g:t,h:e.s(t<p.weituo_person.length-1?"margin-bottom: 10px;":"")}))),J:e.p({name:"trash",size:"5vw",color:"#FF8177"}),K:0===p.weituo_person.length},0===p.weituo_person.length?{L:o._imports_0$4,M:e.o((e=>m()))}:{},{N:u.houseImg},u.houseImg?{O:u.houseImg}:{},{P:e.o((o=>{e.index.chooseImage({count:1,success:o=>{u.houseImg=o.tempFiles[0].path,e.index.showLoading({title:"上传中，请稍后……"});const r=o.tempFilePaths[0].split("/"),t=r[r.length-1];n.$request("",{file:o.tempFiles[0].path,fileType:"file",params:{fileSize:parseFloat((o.tempFiles[0].size/1024).toFixed(2)),fileName:t}}).then((o=>{e.index.request({url:"https://bdcqz.market.alicloudapi.com/ocrservice/estateCert",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{url:o.data.url},success:e=>{let o=e.data.data;p.address=o["坐落"],p.area=o["房屋建筑面积"],p.card_number=o["证号"]}}),e.index.hideLoading()}))}})})),Q:e.o((o=>(()=>{if(""===p.address||""===p.area||""===p.card_number||""===p.house_has_type||""===p.house_mortgage_order||""===p.house_power_type||""===p.house_use_type||0===p.owners.length||""===p.price)return void _("资料未填写完成");let o;2===s.type?(o=e.index.getStorageSync("houseArray"),o[s.houseIndex]=p):e.index.getStorageSync("houseArray")?(o=e.index.getStorageSync("houseArray"),o.push(p)):(o=[],o.push(p)),e.index.setStorageSync("houseArray",o),e.index.removeStorageSync("ownerArray"),e.index.removeStorageSync("weituo_personArray"),r.back()})())),R:e.p({confirmText:"确定"}),S:u.tips_popup},u.tips_popup?{T:e.t(u.tipsText)}:{},{U:e.sr(i,"8a468c72-9",{k:"uPickerRef"}),V:e.o(w),W:e.o(v),X:e.o((e=>y())),Y:e.o((e=>y())),Z:e.p({show:u.address_show,title:"坐落城市",columns:u.columns,keyName:"label",closeOnClickOverlay:!0}),aa:u.pub_picker},u.pub_picker?{ab:e.o((e=>u.pub_picker=!1)),ac:e.t(u.column[u.pub_name].picker_title),ad:e.o((e=>(p[u.pub_name]=u.column[u.pub_name].list[u.select_value].name,u.select_value=0,void(u.pub_picker=!1)))),ae:e.f(u.column[u.pub_name].list,((o,r,t)=>({a:e.t(o.name),b:r}))),af:u.pub_value,ag:e.o(h)}:{},{ah:u.pub_picker},u.pub_picker?{ai:e.o((e=>u.pub_picker=!1))}:{})}});wx.createPage(a);
