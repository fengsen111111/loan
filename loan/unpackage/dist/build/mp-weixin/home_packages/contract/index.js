"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group"))()}Math||(t+(()=>"../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+o)();const t=()=>"../../components/navbar.js",o=()=>"../../components/option-bt.js",a=e.defineComponent({__name:"index",setup(t){const{appContext:o}=e.getCurrentInstance(),a=o.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const r=e.reactive({checked:[],autograph:"",info:{},tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",flag:!0}),i=e.reactive({verify_code:e.index.getStorageSync("user_order_info").verify_code,auth_mobile:e.index.getStorageSync("user_order_info").auth_mobile,order_id:"",sign_image:""});a.$request("/loan/Order/getUnSignOrderDetail").then((e=>{r.info=e.data,i.order_id=e.data.id})),e.onShow((()=>{if("empty"===e.index.getStorageSync("autograph"))return r.autograph="",void e.index.removeStorageSync("autograph");if(e.index.getStorageSync("autograph")){r.autograph=e.index.getStorageSync("autograph");const t=r.autograph.split("/"),o=t[t.length-1];e.index.getFileSystemManager().getFileInfo({filePath:r.autograph,success:e=>{a.$request("",{file:r.autograph,fileType:"file",params:{fileSize:parseFloat((e.size/1024).toFixed(2)),fileName:o}}).then((e=>{i.sign_image=e.data.url}))}}),e.index.removeStorageSync("autograph")}}));const n=e=>{var t=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],o=["","拾","佰","仟"],a=["","万","亿","兆"],r=["角","分","毫","厘"];let i,n;var s="";let p;if(""===e)return"";if((e=parseFloat(e))>=1e15)return"";if(0===e)return s=t[0]+"元整";if(-1===(e=e.toString()).indexOf(".")?(i=e,n=""):(p=e.split("."),i=p[0],n=p[1].substr(0,4)),parseInt(i,10)>0){for(var l=0,g=i.length,c=0;c<g;c++){var u=i.substr(c,1),d=g-c-1,m=d/4,h=d%4;"0"===u?l++:(l>0&&(s+=t[0]),l=0,s+=t[parseInt(u)]+o[h]),0===h&&l<4&&(s+=a[m])}s+="元"}if(""!==n){var _=n.length;for(c=0;c<_;c++)"0"!==(u=n.substr(c,1))&&(s+=t[Number(u)]+r[c])}return""===s?s+=t[0]+"元整":""===n&&(s+="整"),s},s=e=>{r.tipsText=e,r.tips_popup=!0,null!==r.tips_timer&&clearTimeout(r.tips_timer),r.tips_timer=setTimeout((()=>{r.tips_popup=!1}),2e3)};return(t,o)=>e.e({a:e.p({title:"合同确认"}),b:r.info.order_material},r.info.order_material?{c:e.t(t.$cardUtil(r.info.order_material.card_number)),d:e.t(r.info.contract_num),e:e.t(r.info.order_material.apply_money),f:e.t(n(r.info.order_material.apply_money)),g:e.t("day"===r.info.rate_type?"按天":"month"===r.info.rate_type?"按月":"year"===r.info.rate_type?"按年":""),h:e.t(r.info.order_material.loan_time),i:e.t(r.info.order_material.loan_rate),j:e.t(r.info.order_material.repayment_type)}:{},{k:e.p({name:1,shape:"circle"}),l:e.o((e=>t.$navigateTo("/pages/rich_text/index",{url:"/loan/Setting/getDigitalAgreeContent",title:"电子签意授权书"}))),m:e.o((e=>t.$navigateTo("/pages/rich_text/index",{url:"/loan/Setting/getUserMessageAuthContent",title:"征信授权书"}))),n:e.o((e=>r.checked=e)),o:e.p({modelValue:r.checked}),p:""!==i.sign_image},""!==i.sign_image?{q:i.sign_image}:{},{r:e.o((e=>t.$navigateTo("/home_packages/autograph/index",{name:r.info.order_material.leader_name||r.info.order_material.name}))),s:e.o((t=>{r.flag&&(1===r.checked[0]?""!==i.sign_image?(r.flag=!1,e.index.showLoading({title:"请稍后",mask:!0}),a.$request("/loan/Order/signOrder",i).then((()=>{e.index.hideLoading(),e.index.showToast({mask:!0,title:"签约成功",icon:"success",duration:2e3}),setTimeout((()=>{r.flag=!0,e.index.switchTab({url:"/pages/user_home/index"})}),2e3)})).catch((t=>{e.index.hideLoading(),e.index.showToast({mask:!0,title:t.message,icon:"none",duration:2e3}),r.flag=!0}))):s("资料未填写完成"):s("请阅读并同意相关授权书"))})),t:e.o((e=>t.$back())),v:e.p({confirmText:"提交",confirmBgColor:"#1592E6",showCancel:!0,cancelText:"返回",cancelColor:"#999999",cancelBgColor:"#F6F7FB"}),w:r.tips_popup},r.tips_popup?{x:e.t(r.tipsText)}:{})}});wx.createPage(a);
