"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-picker")+e.resolveComponent("l-calendar"))()}Math||((()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+t+(()=>"../../node-modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../uni_modules/l-calendar/components/l-calendar/l-calendar.js"))();const t=()=>"../option-bt.js",n=e.defineComponent({__name:"borrowing",props:{showFlag:{type:Boolean}},emits:["next"],setup(t,{emit:n}){const a=n,o=t,{appContext:r}=e.getCurrentInstance(),l=r.config.globalProperties,s=e.ref(null),i=e.reactive({front:"",behind:"",timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[1],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",address_show:!1,columns:[],firstIndex:0,calenderShow:!1,pub_value:[],pub_picker:!1,column:{},pub_name:"",select_value:0,showPayment:"N"===e.index.getStorageSync("open_ll_status"),rate_range:"",dxMoney:""}),p=e.reactive({sign_address:"四川省-成都市-彭州市",apply_money:"",loan_rate:"",loan_time:"",start_time:"",end_time:"",repayment_type:"",use_type:"",payment_bank_id:"",payment_bank_text:"",return_bank_id:"",return_bank_text:""});e.onShow((()=>{if(i.showPayment&&e.index.getStorageSync("bankInfo1")){const t=e.index.getStorageSync("bankInfo1");p.payment_bank_id=t.id,p.payment_bank_text=(t.bank_name||"")+" "+t.bank_acctno,e.index.removeStorageSync("bankInfo1")}if(e.index.getStorageSync("bankInfo2")){const t=e.index.getStorageSync("bankInfo2");p.return_bank_id=t.id,p.return_bank_text=(t.bank_name||"")+" "+t.bank_acctno,e.index.removeStorageSync("bankInfo2")}})),e.onMounted((()=>{i.rate_range=e.index.getStorageSync("rate_range"),l.$request("/loan/Order/getOrderDetail",{order_id:e.index.getStorageSync("order_id"),page_number:4}).then((e=>{0!==e.data.order_material.length&&Object.assign(p,e.data.order_material)}))}));const _=()=>{c(p.apply_money)},c=e=>{if(!/^(0|[1-9]\d*)(\.\d+)?$/.test(e))return i.dxMoney="数据非法",!1;var t="千佰拾亿千佰拾万千佰拾元角分",n="",a=(e+="00").indexOf(".");a>=0&&(e=e.substring(0,a)+e.substr(a+1,2)),t=t.substr(t.length-e.length);for(var o=0;o<e.length;o++)n+="零壹贰叁肆伍陆柒捌玖".charAt(e.charAt(o))+t.charAt(o);return i.dxMoney=n.replace(/零(千|佰|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万|壹(拾)/g,"$1$2").replace(/^元零?|零分/g,"").replace(/元$/g,"元整"),!1},u=e=>`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}`,m=()=>{console.log("贷款期数变化了",p.loan_time);const e=new Date(new Date);p.start_time=u(e);const t=((e,t)=>{const n=new Date(e),a=n.getDate();return n.setMonth(n.getMonth()+1*t),n.getDate()!==a&&n.setDate(0),n})(e,p.loan_time);p.end_time=u(t),console.log(p.start_time,p.end_time)},d=e=>{p.start_time=e.startDate,p.end_time=e.endDate,i.calenderShow=!1},g=e=>{i.tipsText=e,i.tips_popup=!0,null!==i.tips_timer&&clearTimeout(i.tips_timer),i.tips_timer=setTimeout((()=>{i.tips_popup=!1}),2e3)};l.$request("/loan/Dictionary/getDictionary").then((e=>{let t={};e.data.records.map((e=>{t[e.key]={picker_title:e.name,list:e.values.map((e=>({name:e})))}})),i.column=t}));const b=e=>{i.select_value=e.detail.value[0]},y=e=>{o.showFlag||(i.pub_name=e,i.pub_picker=!0)};l.$request("/factory_system/Base/getAreas").then((t=>{i.columns=[t.data.areas],e.nextTick$1((()=>{s.value.setColumnValues(1,i.columns[0][0].children),s.value.setColumnValues(2,i.columns[0][0].children[0].children)}))}));const h=()=>{i.address_show=!1},k=e=>{p.sign_address="",e.value.map(((t,n)=>{p.sign_address+=n===e.value.length-1?t.label:t.label+"-"})),h()},w=e=>{const{columnIndex:t,index:n}=e;0===t&&(s.value.setColumnValues(1,i.columns[0][n].children),s.value.setColumnValues(2,i.columns[0][n].children[0].children),i.firstIndex=n),1===t&&s.value.setColumnValues(2,i.columns[0][i.firstIndex].children[n].children)};return(t,n)=>e.e({a:!o.showFlag},(o.showFlag,{}),{b:e.t(p.sign_address),c:e.o(_),d:o.showFlag,e:p.apply_money,f:e.o((e=>p.apply_money=e.detail.value)),g:e.t(i.dxMoney),h:"请输入执行利率("+i.rate_range+")",i:o.showFlag,j:p.loan_rate,k:e.o((e=>p.loan_rate=e.detail.value)),l:o.showFlag,m:e.o((e=>m())),n:p.loan_time,o:e.o((e=>p.loan_time=e.detail.value)),p:e.t(p.start_time?p.start_time+" - "+p.end_time:"请选择借款期限"),q:e.s(p.start_time?"":"color:#666666"),r:e.o((e=>i.calenderShow=!0)),s:e.t(p.repayment_type),t:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),v:e.o((e=>y("repayment_type"))),w:e.t(p.use_type),x:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),y:e.o((e=>y("use_type"))),z:i.showPayment},i.showPayment?{A:e.t(p.payment_bank_text),B:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),C:e.o((e=>o.showFlag?"":t.$navigateTo("/home_packages/select_bank_card/index",{type:1})))}:{},{D:e.t(p.return_bank_text),E:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),F:e.o((e=>o.showFlag?"":t.$navigateTo("/home_packages/select_bank_card/index",{type:2}))),G:!o.showFlag},o.showFlag?{}:{H:e.o((t=>(()=>{if(""===p.sign_address||""===p.apply_money||""===p.loan_rate||""===p.loan_time||""===p.start_time||""===p.repayment_type||""===p.use_type)return void g("资料未填写完成");if(i.showPayment&&""===p.payment_bank_id)return void g("资料未填写完成");const t=i.rate_range.split("-"),n=Number(t[0].split("%")[0]),o=Number(t[1].split("%")[0]);parseFloat(p.loan_rate)<n?g(`执行利率设置最小值不能超过产品设置的执行利率：${n}-${o}`):parseFloat(p.loan_rate)>o?g(`执行利率设置最大值不能超过产品设置的执行利率：${n}-${o}`):Number(p.loan_time)>Number(e.index.getStorageSync("loan_time"))?g("贷款期数超过可贷期数"):l.$request("/loan/Order/makeOrder",{id:e.index.getStorageSync("order_id"),page_number:4,...p}).then((()=>{a("next")}))})()))},{I:i.tips_popup},i.tips_popup?{J:e.t(i.tipsText)}:{},{K:e.sr(s,"7489eeaa-5",{k:"uPickerRef"}),L:e.o(k),M:e.o(w),N:e.o((e=>h())),O:e.o((e=>h())),P:e.p({show:i.address_show,title:"合同签署地",columns:i.columns,keyName:"label",closeOnClickOverlay:!0}),Q:e.o(d),R:e.o((e=>i.calenderShow=!1)),S:e.p({visible:i.calenderShow,isRange:!0}),T:i.pub_picker},i.pub_picker?{U:e.o((e=>i.pub_picker=!1)),V:e.t(i.column[i.pub_name].picker_title),W:e.o((e=>(p[i.pub_name]=i.column[i.pub_name].list[i.select_value].name,i.select_value=0,void(i.pub_picker=!1)))),X:e.f(i.column[i.pub_name].list,((t,n,a)=>({a:e.t(t.name),b:n}))),Y:i.pub_value,Z:e.o(b)}:{},{aa:i.pub_picker},i.pub_picker?{ab:e.o((e=>i.pub_picker=!1))}:{})}});wx.createComponent(n);
