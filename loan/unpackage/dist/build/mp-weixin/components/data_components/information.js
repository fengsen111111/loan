"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/dateFormat.js");if(!Array){(e.resolveComponent("u-radio")+e.resolveComponent("u-radio-group")+e.resolveComponent("u-checkbox")+e.resolveComponent("u-checkbox-group")+e.resolveComponent("l-calendar"))()}Math||((()=>"../../node-modules/uview-plus/components/u-radio/u-radio.js")+(()=>"../../node-modules/uview-plus/components/u-radio-group/u-radio-group.js")+(()=>"../../node-modules/uview-plus/components/u-checkbox/u-checkbox.js")+(()=>"../../node-modules/uview-plus/components/u-checkbox-group/u-checkbox-group.js")+o+(()=>"../../uni_modules/l-calendar/components/l-calendar/l-calendar.js"))();const o=()=>"../option-bt.js",t=e.defineComponent({__name:"information",props:{showFlag:{type:Boolean}},emits:["next"],setup(o,{emit:t}){const r=t,l=o,{appContext:n}=e.getCurrentInstance(),d=n.config.globalProperties,s=e.reactive({timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",calenderShow:!1,verifyFlag:!0,botShow:!0}),i=e.reactive({card_image_front:"",card_image_back:"",name:"",card_number:"",id_card_address:"",open_ll_status:"Y",ll_user_type:"INNERUSER",ll_bank_acctname:"",ll_bank_card_number:"",id_card_end_time:"",mobile:"",verify_code:""}),c=async()=>{if(console.log("失去焦点",i.card_number.length),18==i.card_number.length){console.log("长度满足，开始调用接口");const a=await d.$request("/loan/Order/checkUserLoanMoney",{card_number:i.card_number});console.log("结果",a.data.message),a.data.message&&e.index.showModal({title:"提示",content:a.data.message,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})}},_=e=>{i.id_card_end_time=e.startDate+" - "+e.endDate,s.calenderShow=!1};e.onMounted((()=>{e.index.request({url:"https://api.qfcss.cn/decoration/Setting/ctlLoan",method:"POST",success:e=>{"N"===e.data.data.result?s.botShow=!1:s.botShow=!0},complete:e=>{404===e.statusCode&&(s.botShow=!0)}}),e.index.getStorageSync("order_id")&&(i.id=e.index.getStorageSync("order_id"),d.$request("/loan/Order/getOrderDetail",{order_id:i.id,page_number:1}).then((e=>{0!==e.data.order_material.length&&Object.assign(i,e.data.order_material)})))}));const u=e=>{s.tipsText=e,s.tips_popup=!0,null!==s.tips_timer&&clearTimeout(s.tips_timer),s.tips_timer=setTimeout((()=>{s.tips_popup=!1}),2e3)},m=a=>{l.showFlag||e.index.chooseImage({count:1,success:o=>{e.index.showLoading({title:"上传中，请稍后……"});const t=o.tempFilePaths[0].split("/"),r=t[t.length-1];d.$request("",{file:o.tempFiles[0].path,fileType:"file",params:{fileSize:parseFloat((o.tempFiles[0].size/1024).toFixed(2)),fileName:r}}).then((o=>{"front"===a?(i.card_image_front=o.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:o.data.url,configure:{side:"face"}},success:e=>{let a=e.data;i.name=a.name,i.card_number=a.num,i.id_card_address=a.address,c(),i.ll_bank_acctname=a.name,i.ll_bank_card_number=a.num},fail:()=>{u("请按要求上传身份证人像面（正面）")}})):"back"===a&&(i.card_image_back=o.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:o.data.url,configure:{side:"back"}},success:e=>{let a=e.data;const o=/^(\d{4})(\d{2})(\d{2})$/;i.id_card_end_time=a.start_date.replace(o,"$1.$2.$3")+" - "+a.end_date.replace(o,"$1.$2.$3")},fail:()=>{u("请按要求上传身份证国徽面（背面）")}})),e.index.hideLoading()}))}})};return(o,t)=>e.e({a:!l.showFlag},(l.showFlag,{}),{b:i.card_image_front},i.card_image_front?{c:i.card_image_front}:{},{d:e.o((e=>m("front"))),e:i.card_image_back},i.card_image_back?{f:i.card_image_back}:{},{g:e.o((e=>m("back"))),h:l.showFlag,i:i.name,j:e.o((e=>i.name=e.detail.value)),k:l.showFlag,l:e.o(c),m:i.card_number,n:e.o((e=>i.card_number=e.detail.value)),o:l.showFlag,p:i.id_card_address,q:e.o((e=>i.id_card_address=e.detail.value)),r:e.t(i.id_card_end_time||"请选择证件有效期"),s:e.s(i.id_card_end_time?"":"color:#777777"),t:e.o((()=>{!l.showFlag&&(s.calenderShow=!0)})),v:e.p({name:"Y",label:"开通",labelSize:"3.2vw"}),w:e.p({name:"N",label:"不开通",labelSize:"3.2vw"}),x:e.o((e=>i.open_ll_status=e)),y:e.p({shape:"circle",activeColor:"#F97E39",disabled:l.showFlag,modelValue:i.open_ll_status}),z:"Y"===i.open_ll_status},"Y"===i.open_ll_status?{A:e.p({name:"INNERUSER",label:"个人用户",labelSize:"3.2vw"}),B:e.p({name:"INNERCOMPANY",label:"企业用户",labelSize:"3.2vw"}),C:e.o((e=>i.ll_user_type=e)),D:e.p({shape:"circle",activeColor:"#F97E39",disabled:l.showFlag,modelValue:i.ll_user_type})}:{},{E:"Y"===i.open_ll_status},"Y"===i.open_ll_status?{F:l.showFlag,G:i.ll_bank_acctname,H:e.o((e=>i.ll_bank_acctname=e.detail.value))}:{},{I:"Y"===i.open_ll_status},"Y"===i.open_ll_status?{J:l.showFlag,K:i.ll_bank_card_number,L:e.o((e=>i.ll_bank_card_number=e.detail.value))}:{},{M:l.showFlag,N:i.mobile,O:e.o((e=>i.mobile=e.detail.value)),P:!l.showFlag},l.showFlag?{}:{Q:e.p({name:1,shape:"circle",activeColor:"#F97E39"}),R:e.o((e=>o.$navigateTo("/pages/rich_text/index",{url:"/loan/Setting/getUserProtocol"}))),S:e.o((e=>s.checked=e)),T:e.p({modelValue:s.checked})},{U:!l.showFlag&&s.botShow},!l.showFlag&&s.botShow?{V:e.o((o=>{1===s.checked[0]?""!==i.name&&""!==i.card_number&&""!==i.id_card_end_time&&""!==i.mobile&&("Y"!==i.open_ll_status||""!==i.ll_bank_acctname&&""!==i.ll_bank_card_number)?(e.index.setStorageSync("orderInfo",{name:i.name,id_card:i.card_number,mobile:i.mobile}),d.$request("/loan/Order/makeOrder",{goods_id:e.index.getStorageSync("goods_id"),type:"person",page_number:1,...i}).then((o=>{e.index.setStorageSync("order_id",o.data.id),e.index.setStorageSync("order_time",a.dateFormat(new Date,"date")),e.index.setStorageSync("open_ll_status",i.open_ll_status),e.index.setStorageSync("setInfoFormData",i),r("next")}))):u("资料未填写完成"):u("请阅读并同意《用户服务与隐私保护协议》")}))}:{},{W:s.tips_popup},s.tips_popup?{X:e.t(s.tipsText)}:{},{Y:e.o(_),Z:e.o((e=>s.calenderShow=!1)),aa:e.p({visible:s.calenderShow,isRange:!0,idCard:!0})})}});wx.createComponent(t);
