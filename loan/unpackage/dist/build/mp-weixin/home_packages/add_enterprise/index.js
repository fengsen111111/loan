"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/jump.js");if(!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-picker")+e.resolveComponent("l-calendar"))()}Math||(n+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+o+(()=>"../../node-modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../uni_modules/l-calendar/components/l-calendar/l-calendar.js"))();const n=()=>"../../components/navbar.js",o=()=>"../../components/option-bt.js",r=e.defineComponent({__name:"index",props:{type:{type:Number}},setup(n){const o=n,{appContext:r}=e.getCurrentInstance(),t=r.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const c=e.reactive({front:"",behind:"",timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[1],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",pub_value:[],pub_picker:!1,column:{},pub_name:"",key:"",select_value:0,address_show:!1,columns:[],firstIndex:0,calenderShow:!1}),l=e.reactive({type:"company",name:"",card_number:"",company_license_image:"",company_end_time:"",company_work_city:"",company_work_address:"",company_leader_name:"",company_leader_relationship:"",company_leader_card_type:"",company_leader_card_number:""}),i=e.ref(null);t.$request("/loan/Dictionary/getDictionary").then((e=>{let a={};e.data.records.map((e=>{a[e.key]={picker_title:e.name,list:e.values.map((e=>({name:e})))}})),c.column=a}));const s=e=>{c.select_value=e.detail.value[0]},p=e=>{l.company_end_time=e.startDate+"-"+e.endDate,c.calenderShow=!1},m=(e,a)=>{c.pub_name=e,c.key=a,c.pub_picker=!0},d=e=>{c.tipsText=e,c.tips_popup=!0,null!==c.tips_timer&&clearTimeout(c.tips_timer),c.tips_timer=setTimeout((()=>{c.tips_popup=!1}),2e3)};t.$request("/factory_system/Base/getAreas").then((a=>{c.columns=[a.data.areas],e.nextTick$1((()=>{i.value.setColumnValues(1,c.columns[0][0].children),i.value.setColumnValues(2,c.columns[0][0].children[0].children)}))}));const _=()=>{c.address_show=!1},u=e=>{l.company_work_city="",e.value.map(((a,n)=>{l.company_work_city+=n===e.value.length-1?a.label:a.label+"-"})),_()},y=e=>{const{columnIndex:a,index:n}=e;0===a&&(i.value.setColumnValues(1,c.columns[0][n].children),i.value.setColumnValues(2,c.columns[0][n].children[0].children),c.firstIndex=n),1===a&&i.value.setColumnValues(2,c.columns[0][c.firstIndex].children[n].children)};return(n,r)=>e.e({a:e.p({title:1===o.type?"新增企业共借人":"新增企业融担方"}),b:e.t(1===o.type?"新增企业共借人":"新增企业融担方"),c:l.company_license_image},l.company_license_image?{d:l.company_license_image}:{},{e:e.o((a=>{e.index.chooseImage({count:1,success:a=>{e.index.showLoading({title:"上传中，请稍后……"});const n=a.tempFilePaths[0].split("/"),o=n[n.length-1];t.$request("",{file:a.tempFiles[0].path,fileType:"file",params:{fileSize:parseFloat((a.tempFiles[0].size/1024).toFixed(2)),fileName:o}}).then((a=>{l.company_license_image=a.data.url,e.index.request({url:"https://bizlicense.market.alicloudapi.com/rest/160601/ocr/ocr_business_license.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:a.data.url},success:e=>{let a=e.data;const n=/^(\d{4})(\d{2})(\d{2})$/;l.name=a.name,l.card_number=a.reg_num,l.company_end_time=a.establish_date.replace(n,"$1.$2.$3")+" - "+a.valid_period.replace(n,"$1.$2.$3")}}),e.index.hideLoading()}))}})})),f:l.name,g:e.o((e=>l.name=e.detail.value)),h:l.card_number,i:e.o((e=>l.card_number=e.detail.value)),j:e.t(l.company_end_time||"请选择营业期限"),k:e.s(l.company_end_time?"":"color:#777777"),l:e.o((()=>{c.calenderShow=!0})),m:e.t(l.company_work_city),n:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),o:e.o((e=>{c.address_show=!0})),p:l.company_work_address,q:e.o((e=>l.company_work_address=e.detail.value)),r:l.company_leader_name,s:e.o((e=>l.company_leader_name=e.detail.value)),t:e.t(l.company_leader_relationship),v:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),w:e.o((e=>m("company_leader_relationship","emergency_contact_relationship"))),x:e.t(l.company_leader_card_type),y:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),z:e.o((e=>m("company_leader_card_type","leader_card_type"))),A:l.company_leader_card_number,B:e.o((e=>l.company_leader_card_number=e.detail.value)),C:e.o((n=>(()=>{if(""===l.card_number||""===l.company_end_time||""===l.company_leader_card_number||""===l.company_leader_card_type||""===l.company_leader_name||""===l.company_leader_relationship||""===l.company_work_address||""===l.company_work_city)return void d("资料未填写完成");let n;1===o.type?(e.index.getStorageSync("personArray")?(n=e.index.getStorageSync("personArray"),n.push(l)):(n=[],n.push(l)),e.index.setStorageSync("personArray",n)):(e.index.getStorageSync("companyArray")?(n=e.index.getStorageSync("companyArray"),n.push(l)):(n=[],n.push(l)),e.index.setStorageSync("companyArray",n)),a.back()})())),D:e.p({confirmText:"确定"}),E:c.tips_popup},c.tips_popup?{F:e.t(c.tipsText)}:{},{G:e.sr(i,"49bb5ef2-5",{k:"uPickerRef"}),H:e.o(u),I:e.o(y),J:e.o((e=>_())),K:e.o((e=>_())),L:e.p({show:c.address_show,title:"办公城市",columns:c.columns,keyName:"label",closeOnClickOverlay:!0}),M:c.pub_picker},c.pub_picker?{N:e.o((e=>c.pub_picker=!1)),O:e.t(c.column[c.key].picker_title),P:e.o((e=>(l[c.pub_name]=c.column[c.key].list[c.select_value].name,c.select_value=0,void(c.pub_picker=!1)))),Q:e.f(c.column[c.key].list,((a,n,o)=>({a:e.t(a.name),b:n}))),R:c.pub_value,S:e.o(s)}:{},{T:c.pub_picker},c.pub_picker?{U:e.o((e=>c.pub_picker=!1))}:{},{V:e.o(p),W:e.o((e=>c.calenderShow=!1)),X:e.p({visible:c.calenderShow,isRange:!0})})}});wx.createPage(r);
