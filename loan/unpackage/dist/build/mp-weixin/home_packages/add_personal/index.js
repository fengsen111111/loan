"use strict";const e=require("../../common/vendor.js"),r=require("../../utils/jump.js");if(!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-picker")+e.resolveComponent("l-calendar"))()}Math||(a+(()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+n+(()=>"../../node-modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../uni_modules/l-calendar/components/l-calendar/l-calendar.js"))();const a=()=>"../../components/navbar.js",n=()=>"../../components/option-bt.js",o=e.defineComponent({__name:"index",props:{type:{type:Number}},setup(a){const n=a,{appContext:o}=e.getCurrentInstance(),s=o.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const t=e.ref(null),i=e.reactive({front:"",behind:"",timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[1],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",pub_value:[],pub_picker:!1,column:{},pub_name:"",key:"",select_value:0,address_show:!1,columns:[],firstIndex:0,calenderShow:!1}),d=e.reactive({type:"person",name:"",card_number:"",person_mobile:"",person_id_card_image_front:"",person_id_card_image_back:"",person_id_card_end_time:"",person_relationship:"",person_marriage:"",person_city_address:"",person_address:""});s.$request("/loan/Dictionary/getDictionary").then((e=>{let r={};e.data.records.map((e=>{r[e.key]={picker_title:e.name,list:e.values.map((e=>({name:e})))}})),i.column=r}));const c=e=>{d.person_id_card_end_time=e.startDate+" - "+e.endDate,i.calenderShow=!1},p=e=>{i.select_value=e.detail.value[0]},l=(e,r)=>{i.pub_name=e,i.key=r,i.pub_picker=!0};s.$request("/factory_system/Base/getAreas").then((r=>{i.columns=[r.data.areas],e.nextTick$1((()=>{t.value.setColumnValues(1,i.columns[0][0].children),t.value.setColumnValues(2,i.columns[0][0].children[0].children)}))}));const _=()=>{i.address_show=!1},u=e=>{d.person_city_address="",e.value.map(((r,a)=>{d.person_city_address+=a===e.value.length-1?r.label:r.label+"-"})),_()},m=e=>{const{columnIndex:r,index:a}=e;0===r&&(t.value.setColumnValues(1,i.columns[0][a].children),t.value.setColumnValues(2,i.columns[0][a].children[0].children),i.firstIndex=a),1===r&&t.value.setColumnValues(2,i.columns[0][i.firstIndex].children[a].children)},h=e=>{i.tipsText=e,i.tips_popup=!0,null!==i.tips_timer&&clearTimeout(i.tips_timer),i.tips_timer=setTimeout((()=>{i.tips_popup=!1}),2e3)},b=r=>{e.index.chooseImage({count:1,success:a=>{e.index.showLoading({title:"上传中，请稍后……"});const n=a.tempFilePaths[0].split("/"),o=n[n.length-1];s.$request("",{file:a.tempFiles[0].path,fileType:"file",params:{fileSize:parseFloat((a.tempFiles[0].size/1024).toFixed(2)),fileName:o}}).then((a=>{"front"===r?(d.person_id_card_image_front=a.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:a.data.url,configure:{side:"face"}},success:e=>{let r=e.data;d.name=r.name,d.card_number=r.num},fail:()=>{h("请按要求上传身份证人像面（正面）")}})):"back"===r&&(d.person_id_card_image_back=a.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:a.data.url,configure:{side:"back"}},success:e=>{let r=e.data;const a=/^(\d{4})(\d{2})(\d{2})$/;d.person_id_card_end_time=r.start_date.replace(a,"$1.$2.$3")+" - "+r.end_date.replace(a,"$1.$2.$3")},fail:()=>{h("请按要求上传身份证国徽面（背面）")}})),e.index.hideLoading()}))}})};return(a,o)=>e.e({a:e.p({title:1===n.type?"新增个人共借人":"新增个人融担方"}),b:e.t(1===n.type?"新增个人共借人":"新增个人融担方"),c:d.person_id_card_image_front},d.person_id_card_image_front?{d:d.person_id_card_image_front}:{},{e:e.o((e=>b("front"))),f:d.person_id_card_image_back},d.person_id_card_image_back?{g:d.person_id_card_image_back}:{},{h:e.o((e=>b("back"))),i:d.name,j:e.o((e=>d.name=e.detail.value)),k:d.card_number,l:e.o((e=>d.card_number=e.detail.value)),m:e.t(d.person_id_card_end_time||"请选择证件有效期"),n:e.s(d.person_id_card_end_time?"":"color:#777777"),o:e.o((()=>{i.calenderShow=!0})),p:d.person_mobile,q:e.o((e=>d.person_mobile=e.detail.value)),r:e.t(d.person_relationship),s:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),t:e.o((e=>l("person_relationship","emergency_contact_relationship"))),v:e.t(d.person_marriage),w:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),x:e.o((e=>l("person_marriage","marriage"))),y:e.t(d.person_city_address),z:e.p({name:"arrow-down",size:"5vw",color:"#666666"}),A:e.o((e=>{i.address_show=!0})),B:d.person_address,C:e.o((e=>d.person_address=e.detail.value)),D:e.o((a=>(()=>{if(""===d.card_number||""===d.name||""===d.person_address||""===d.person_id_card_end_time||""===d.person_marriage||""===d.person_mobile||""===d.person_relationship||""===d.type)return void h("资料未填写完成");let a;1===n.type?(e.index.getStorageSync("personArray")?(a=e.index.getStorageSync("personArray"),a.push(d)):(a=[],a.push(d)),e.index.setStorageSync("personArray",a)):(e.index.getStorageSync("companyArray")?(a=e.index.getStorageSync("companyArray"),a.push(d)):(a=[],a.push(d)),e.index.setStorageSync("companyArray",a)),r.back()})())),E:e.p({confirmText:"确定"}),F:i.tips_popup},i.tips_popup?{G:e.t(i.tipsText)}:{},{H:e.sr(t,"d11a6134-5",{k:"uPickerRef"}),I:e.o(u),J:e.o(m),K:e.o((e=>_())),L:e.o((e=>_())),M:e.p({show:i.address_show,title:"居住城市",columns:i.columns,keyName:"label",closeOnClickOverlay:!0}),N:i.pub_picker},i.pub_picker?{O:e.o((e=>i.pub_picker=!1)),P:e.t(i.column[i.key].picker_title),Q:e.o((e=>(d[i.pub_name]=i.column[i.key].list[i.select_value].name,i.select_value=0,void(i.pub_picker=!1)))),R:e.f(i.column[i.key].list,((r,a,n)=>({a:e.t(r.name),b:a}))),S:i.pub_value,T:e.o(p)}:{},{U:i.pub_picker},i.pub_picker?{V:e.o((e=>i.pub_picker=!1))}:{},{W:e.o(c),X:e.o((e=>i.calenderShow=!1)),Y:e.p({visible:i.calenderShow,isRange:!0,idCard:!0})})}});wx.createPage(o);
