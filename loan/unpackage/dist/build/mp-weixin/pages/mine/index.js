"use strict";const e=require("../../common/vendor.js"),n=require("../../common/assets.js");if(!Array){e.resolveComponent("u-icon")()}Math||((()=>"../../node-modules/uview-plus/components/u-icon/u-icon.js")+o)();const o=()=>"../../components/tabbar.js",t=e.defineComponent({__name:"index",setup(o){const t=e.reactive({statusBarHeight:getApp().globalData.statusBarHeight,navigationBarHeight:getApp().globalData.navigationBarHeight,navHeight:getApp().globalData.navHeight,popup_state:!1,html_content:"",openId:null,userInfo:{},token:e.index.getStorageSync("token"),tab_index:1,popup_not_open:!1,nickName:"",appType:e.index.getStorageSync("appType")||1}),{appContext:a}=e.getCurrentInstance(),i=a.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const r=()=>{i.$request("/loan/User/getUserInfo").then((n=>{t.userInfo=n.data,t.userInfo.user_type.length>1&&2===e.index.getStorageSync("appType")&&(t.userInfo.types_order_number.length>1&&t.userInfo.types_order_number.splice(1,0,{type:"line"}),t.tab_index=2),e.index.setStorageSync("userInfo",n.data),t.nickName=n.data.nickname,e.index.hideTabBar()}))},p=n=>{e.index.setStorageSync("appType",n),t.appType=e.index.getStorageSync("appType"),t.tab_index=t.appType,r()},s=()=>{e.index.login({success:n=>{i.$request("/factory_system/Base/wechatUserRegister",{platform:"mini",code:n.code}).then((n=>{t.openId=n.data.mini_openid,e.index.showToast({title:"微信授权成功",icon:"none",duration:2e3})}))}})},d=n=>{i.$request("/factory_system/Base/getWechatPhoneNumber",{platform:"mini",code:n.detail.code,mini_openid:t.openId}).then((n=>{i.$request("/loan/User/loginAndRegister",{mobile:n.data.phone_number,openid:t.openId}).then((o=>{e.index.setStorageSync("token",o.data.token),2===o.data.business_code?i.$request("/loan/User/updateUserInfo",{mobile:n.data.phone_number}).then((()=>{r()})):r()}))}))},u=n=>{e.index.showLoading({title:"上传中，请稍后……"});const o=n.detail.avatarUrl.split("/"),t=o[o.length-1];i.$request("",{file:n.detail.avatarUrl,fileType:"file",params:{fileSize:0,fileName:t}}).then((n=>{i.$request("/loan/User/updateUserInfo",{head_image:n.data.url}).then((()=>{e.index.hideLoading(),r()}))})),e.index.hideLoading()},l=e=>{t.nickName=e.detail.value},_=()=>{setTimeout((()=>{i.$request("/loan/User/updateUserInfo",{nickname:t.nickName}).then((()=>{r()}))}),200)};e.onShow((()=>{e.index.getStorageSync("token")&&r()}));return(o,a)=>e.e({a:n._imports_0,b:t.statusBarHeight+"px",c:t.navigationBarHeight+"px",d:!t.openId&&!t.token},t.openId||t.token?!t.openId||t.userInfo.id||t.token?{j:t.userInfo.head_image,k:e.o(u),l:e.o(l),m:e.o(_),n:t.nickName,o:e.o((e=>t.nickName=e.detail.value))}:{h:n._imports_1$3,i:e.o(d)}:{e:n._imports_1$3,f:e.o(s)},{g:t.openId&&!t.userInfo.id&&!t.token,p:e.f(t.userInfo.types_order_number,((n,o,t)=>e.e({a:"line"===n.type},"line"===n.type?{}:{b:n.icon},{c:e.t(n.label),d:e.t(n.order_number),e:e.o((o=>{return t="/mine_packages/signing/index",void((a={id:n.loan_type_id,title:n.label}).id&&e.index.navigateTo({url:t+"?id="+a.id+"&title="+a.title}));var t,a}),o),f:o}))),q:t.userInfo.id&&1===t.userInfo.user_type.length||1===t.appType},t.userInfo.id&&1===t.userInfo.user_type.length||1===t.appType?{r:n._imports_2$3,s:e.t(t.userInfo.e_order_number),t:e.o((e=>t.popup_not_open=!0))}:{},{v:n._imports_3$3,w:e.p({name:"arrow-right",size:"5vw",color:"#666666"}),x:e.o((e=>o.$navigateTo("/mine_packages/message/index",!0))),y:n._imports_4$1,z:e.p({name:"arrow-right",size:"5vw",color:"#666666"}),A:e.o((e=>o.$navigateTo("/mine_packages/schedule/index",!0))),B:n._imports_5,C:e.p({name:"arrow-right",size:"5vw",color:"#666666"}),D:e.o((e=>o.$navigateTo("/pages/rich_text/index",{url:"/loan/Setting/aboutUs",title:"关于我们"}))),E:2===t.appType&&t.userInfo.id&&t.userInfo.user_type.length>2},2===t.appType&&t.userInfo.id&&t.userInfo.user_type.length>2?{F:n._imports_6,G:e.p({name:"arrow-right",size:"5vw",color:"#666666"}),H:e.o((e=>p(1)))}:{},{I:1===t.appType&&t.userInfo.id&&t.userInfo.user_type.length>2},1===t.appType&&t.userInfo.id&&t.userInfo.user_type.length>2?{J:n._imports_6,K:e.p({name:"arrow-right",size:"5vw",color:"#666666"}),L:e.o((e=>p(2)))}:{},{M:t.popup_not_open},t.popup_not_open?{N:e.o((e=>t.popup_not_open=!1)),O:e.p({name:"close",size:"5vw",color:"#666666"}),P:n._imports_7,Q:e.o((e=>t.popup_not_open=!1))}:{},{R:t.popup_not_open,S:e.o((e=>t.popup_not_open=!1)),T:e.p({index:t.tab_index})})}});wx.createPage(t);
