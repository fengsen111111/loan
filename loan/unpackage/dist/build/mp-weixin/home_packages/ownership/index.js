"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/jump.js");if(!Array){(e.resolveComponent("u-picker")+e.resolveComponent("l-calendar"))()}Math||(t+r+(()=>"../../node-modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../uni_modules/l-calendar/components/l-calendar/l-calendar.js"))();const t=()=>"../../components/navbar.js",r=()=>"../../components/option-bt.js",d=e.defineComponent({__name:"index",props:{type:{type:Number}},setup(t){const{appContext:r}=e.getCurrentInstance(),d=r.config.globalProperties;e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]});const i=e.ref(null),n=e.reactive({front:"",behind:"",timeNum:59,codeTimer:null,codeText:"发送验证码",checked:[1],tips_popup:!1,tips_timer:null,tipsText:"资料未填写完成",address_show:!1,columns:[],firstIndex:0,calenderShow:!1}),s=e.reactive({card_image_front:"",card_image_back:"",name:"",mobile:"",id_card:"",id_card_end_time:"",address:""});s.address=e.index.getStorageSync("fczdz"),e.index.removeStorageSync("fczdz");const o=e=>{s.id_card_end_time=e.startDate+" - "+e.endDate,n.calenderShow=!1},c=e=>{n.tipsText=e,n.tips_popup=!0,null!==n.tips_timer&&clearTimeout(n.tips_timer),n.tips_timer=setTimeout((()=>{n.tips_popup=!1}),2e3)},l=a=>{e.index.chooseImage({count:1,success:t=>{e.index.showLoading({title:"上传中，请稍后……"});const r=t.tempFilePaths[0].split("/"),i=r[r.length-1];d.$request("",{file:t.tempFiles[0].path,fileType:"file",params:{fileSize:parseFloat((t.tempFiles[0].size/1024).toFixed(2)),fileName:i}}).then((t=>{"front"===a?(s.card_image_front=t.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:t.data.url,configure:{side:"face"}},success:e=>{let a=e.data;s.name=a.name,s.id_card=a.num},fail:()=>{c("请按要求上传身份证人像面（正面）")}})):"back"===a&&(s.card_image_back=t.data.url,e.index.request({url:"https://cardnumber.market.alicloudapi.com/rest/160601/ocr/ocr_idcard.json",header:{Authorization:"APPCODE 5076c8ae1e57459986eb77b688d5d91d"},method:"POST",data:{image:t.data.url,configure:{side:"back"}},success:e=>{let a=e.data;const t=/^(\d{4})(\d{2})(\d{2})$/;s.id_card_end_time=a.start_date.replace(t,"$1.$2.$3")+" - "+a.end_date.replace(t,"$1.$2.$3")},fail:()=>{c("请按要求上传身份证国徽面（背面）")}})),e.index.hideLoading()}))}})};d.$request("/factory_system/Base/getAreas").then((a=>{n.columns=[a.data.areas],e.nextTick$1((()=>{i.value.setColumnValues(1,n.columns[0][0].children),i.value.setColumnValues(2,n.columns[0][0].children[0].children)}))}));const m=()=>{n.address_show=!1},u=e=>{s.city_address="",e.value.map(((a,t)=>{s.city_address+=t===e.value.length-1?a.label:a.label+"-"})),m()},p=e=>{const{columnIndex:a,index:t}=e;0===a&&(i.value.setColumnValues(1,n.columns[0][t].children),i.value.setColumnValues(2,n.columns[0][t].children[0].children),n.firstIndex=t),1===a&&i.value.setColumnValues(2,n.columns[0][n.firstIndex].children[t].children)};return(t,r)=>e.e({a:e.p({title:"新增产权人"}),b:s.card_image_front},s.card_image_front?{c:s.card_image_front}:{},{d:e.o((e=>l("front"))),e:s.card_image_back},s.card_image_back?{f:s.card_image_back}:{},{g:e.o((e=>l("back"))),h:s.name,i:e.o((e=>s.name=e.detail.value)),j:s.mobile,k:e.o((e=>s.mobile=e.detail.value)),l:s.id_card,m:e.o((e=>s.id_card=e.detail.value)),n:e.t(s.id_card_end_time||"请选择证件有效期"),o:e.s(s.id_card_end_time?"":"color:#777777"),p:e.o((()=>{n.calenderShow=!0})),q:s.address,r:e.o((e=>s.address=e.detail.value)),s:e.o((t=>(()=>{if(""===s.card_image_back||""===s.address||""===s.card_image_front||""===s.id_card||""===s.mobile||""===s.id_card_end_time||""===s.name)return void c("资料未填写完成");let t;e.index.getStorageSync("ownerArray")?(t=e.index.getStorageSync("ownerArray"),t.push(s)):(t=[],t.push(s)),e.index.setStorageSync("ownerArray",t),a.back()})())),t:e.p({confirmText:"确定"}),v:n.tips_popup},n.tips_popup?{w:e.t(n.tipsText)}:{},{x:e.sr(i,"0754eaf4-2",{k:"uPickerRef"}),y:e.o(u),z:e.o(p),A:e.o((e=>m())),B:e.o((e=>m())),C:e.p({show:n.address_show,title:"居住地城市",columns:n.columns,keyName:"label",closeOnClickOverlay:!0}),D:e.o(o),E:e.o((e=>n.calenderShow=!1)),F:e.p({visible:n.calenderShow,isRange:!0,idCard:!0})})}});wx.createPage(d);
